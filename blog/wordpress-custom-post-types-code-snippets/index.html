<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhance the power of your WordPress Custom Post Types | Stattic</title>

    <meta name="description" content="Stattic is a fast, lightweight static site generator that optimizes images, supports custom fonts, and easily integrates with GitHub Pages for quick, SEO-friendly site deployment without the bloat of traditional CMS platforms like WordPress.">
    <meta name="keywords" content="SSG, Static Site Generator">
    <meta name="author" content="Robert">

    <link href="/assets/css/tailwind.min.css" rel="stylesheet preload" as="style">
    
        <link href="/assets/css/main.min.css" rel="stylesheet preload" as="style">
    

    <!-- Alpine.js for interactive components -->
    <script src="/assets/js/alpine.min.js" defer></script>
</head>
<body class="bg-background text-primary quicksand-300">

<!-- Skip Links for Accessibility -->
<a href="#main-content" class="skip-link">Skip to main content</a>
<a href="#navigation" class="skip-link">Skip to navigation</a>
<a href="#footer" class="skip-link">Skip to footer</a>

<header class="bg-background shadow" id="navigation">
    <div class="container max-w-screen-xl m-auto py-6 px-4 flex justify-between">
        <h2 class="text-3xl font-bold quicksand-700"><a href="/" class="text-links">Stattic</a></h2>

        <!-- Navigation Menu -->
        <nav>
            <ul class="flex space-x-6">
                
                    <li>
                        <a href="/home-page/" class="text-primary hover:underline quicksand-700">Robert DeVore</a>
                    </li>
                
                    <li>
                        <a href="/contact/" class="text-primary hover:underline quicksand-700">Contact</a>
                    </li>
                
                    <li>
                        <a href="/blog/" class="text-primary hover:underline quicksand-700">Blog</a>
                    </li>
                
                    <li>
                        <a href="/projects/" class="text-primary hover:underline quicksand-700">Projects</a>
                    </li>
                
                    <li>
                        <a href="/wordpress-and-woocommerce-plugins/" class="text-primary hover:underline quicksand-700">WordPress &amp; WooCommerce Plugins</a>
                    </li>
                
                    <li>
                        <a href="/about/" class="text-primary hover:underline quicksand-700">About Robert DeVore</a>
                    </li>
                
            </ul>
        </nav>
    </div>
</header>

<main class="container max-w-2xl m-auto py-10 px-4" id="main-content">
    
<article class="prose dark:prose-dark max-w-none">
    <h1 class="text-6xl font-bold mb-4 text-links quicksand-700">Enhance the power of your WordPress Custom Post Types</h1>
    <p class="text-2md post-meta mb-4 pb-2 text-accent italic border-b border-primary"><span class="date">2017-06-26T15:17:49</span> &middot; <span class="author">Robert</span></p>
    
    <div class="stattic-content mb-12">
        <p>I've been working on extending the <a href="https://www.wpdispensary.com/">WP Dispensary</a> plugin and wanted to share some of the ways I've found to help boost the power of the <strong>Custom Post Types</strong> you create.
Custom Post Types are a great building block for turning WordPress into more than a piece of blogging software.
Going beyond the original Posts and Pages, you can now segment your content as much as you need, with relative ease.
I personally feel that WordPress wouldn't be where it is today without the inclusion of Post Type's in <a href="https://codex.wordpress.org/Version_3.0">version 3.0</a>.
This is my attempt to show how a few simple code snippets can push the boundaries of what's possible with WordPress and Custom Post Types.
Plus, it's a good way for me to keep the codes together in one place to reference in the future ?</p>
<blockquote>
<p>If you're new to CPT's and/or haven't built a Custom Post Type yet, you can check out this article from <a href="https://torquemag.io/2015/12/wordpress-custom-post-types-tutorial/">Torque</a> that breaks CPT's down and gives you a variety of ways to create your own.
Read it?
Got your own already built?
<em>Great!</em>
Let's look at what we can do now that we have our CPT built.
<em>Note: This article assumes you have a basic understanding of developing for WordPress. Please leave a comment or reach out on<a href="https://www.twitter.com/deviorobert">Twitter</a> if you need further clarification on any of the tips below.</em></p>
</blockquote>
<h2>1. Custom API endpoints</h2>
<p>Since this plugin seems like a likely candidate for future app integration, I want to add in some custom API endpoints to allow for content handling in something like <a href="https://angularjs.org/">AngularJS</a> or <a href="https://vuejs.org/">vue.js</a>.
<strong>Giving your featured image an API endpoint</strong>
You can add a function like the one below, adding a filter to <code>rest_prepare_$CPTNAME</code> which will grab the url for the Custom Post Type's post featured image.
In the example below, I want to add the featured image endpoint to my Flowers CPT, so it's <code>rest_prepare_flowers</code>.</p>
<pre><code>/**
 * Adding featured image URL's to Flowers Custom Post Type
 *
 * @access public
 *
 * @param object  $data
 * @param WP_Post $post    The WordPress post object.
 * @param null    $request Unused.
 *
 * @return object The featured image data.
 */
function flowers_featuredimage( $data, $post, $request ) {
    $_data = $data-&gt;data;
    $thumbnail_id = get_post_thumbnail_id( $post-&gt;ID );
    $thumbnail = wp_get_attachment_image_src( $thumbnail_id, 'full' );
    $_data['featured_image_url'] = $thumbnail[0];
    $data-&gt;data = $_data;
    return $data;
}
add_filter( 'rest_prepare_flowers', 'flowers_featuredimage', 10, 3 );
</code></pre>
<p><strong>Adding API endpoints for custom<code>post_tag</code> taxonomies</strong>
With WPD I have a variety of custom taxonomies for the CPT's I created, so I wanted to make sure that data is available via API endpoints too.
The code I use to accomplish this is below.</p>
<pre><code>/**
 * Add Flavor taxonomy for the Flowers Custom Post Type
 */
function flowers_flavor( $data, $post, $request ) {
    $_data = $data-&gt;data;
    $_data['flavors'] = get_the_term_list( $post-&gt;ID, 'flavor', '', ' ', '' );
    $data-&gt;data = $_data;
    return $data;
}
add_filter( 'rest_prepare_flowers', 'flowers_flavor', 10, 3 );
</code></pre>
<p><strong>Adding API endpoints for custom<code>category</code> taxonomies</strong>
The same set up can work for your custom category taxonomies too.</p>
<pre><code>/**
 * Add Category taxonomy for the Concentrates Custom Post Type
 */
function concentrates_category( $data, $post, $request ) {
    $_data = $data-&gt;data;
    $_data['concentrates_category'] = get_the_term_list( $post-&gt;ID, 'concentrates_category', '', ' ', '' );
    $data-&gt;data = $_data;
    return $data;
}
add_filter( 'rest_prepare_concentrates', 'concentrates_category', 10, 3 );
</code></pre>
<p><strong>Adding custom API endpoints for your metabox data</strong>
When you create custom post types, a lot of times you find yourself adding in custom metaboxes to suppor the data you need users to control through your Custom Post Type.
This data can have a custom API endpoint created by using the following code snippet.
The <code>$productsizes</code> array are the metabox information I needed for pricing in the WPD plugin so your set up may vary based on your metaboxes.</p>
<pre><code>/**
 * This adds the wpdispensary_prices metafields to the
 * API callback for flowers
 *
 * @since    1.1.0
 */
add_action( 'rest_api_init', 'slug_register_prices' );
/**
 * Registering Prices
 */
function slug_register_prices() {
    $productsizes = array( '_halfgram', '_gram', '_eighth', '_quarter', '_halfounce', '_ounce' );
    foreach ( $productsizes as $size ) {
        register_rest_field(
            array( 'flowers' ),
            $size,
            array(
                'get_callback'    =&gt; 'slug_get_prices',
                'update_callback' =&gt; null,
                'schema'          =&gt; null,
            )
        );
    } /** /foreach */
}
/**
 * Get Prices
 */
function slug_get_prices( $object, $field_name, $request ) {
    return get_post_meta( $object['id'], $field_name, true );
}
</code></pre>
<p>Once you have your custom post types, taxonomies and metaboxes API endpoints added, you can now allow developers to consume your API data and have more control over how the data gets displayed.
<strong>Custom API endpoints in action</strong>
You can look at an example of each of these endpoints being added into a live API by checking out the CannaBiz demo <a href="https://www.wpdispensary.com/demo/wp-json/wp/v2/flowers">here</a>.</p>
<h2>2. oEmbed improvements</h2>
<p>With <a href="https://www.wpdispensary.com">WP Dispensary</a> I wanted to customize the output of information through the <a href="https://codex.wordpress.org/Embeds">Embeds</a> so that the custom data I display within WPD's single item view gets embedded as well.
The <code>filter</code> below will filter out <code>the_excerpt</code> and replace it with the_content, making sure any content you added into the output of <code>the_content</code> get's displayed properly.</p>
<pre><code>/**
 * Returns the custom excerpt for oEmbeds.
 *
 * @since 1.0
 * @param  string $output Default embed output.
 * @return string         Customize embed output.
 */
add_filter( 'the_excerpt_embed', 'get_excerpt_embed' );
function get_excerpt_embed( $output ) {
    return the_content();
    return $output;
}
add_filter('embed_oembed_html', 'my_embed_oembed_html', 99, 4);
function my_embed_oembed_html($html, $url, $attr, $post_id) {
  return '&lt;div id="wpd-oembed-wrap"&gt;' . $html . '&lt;/div&gt;';
}
</code></pre>
<p>Note that on line 15 there is the <code>wpd-oembed-wrap</code> ID, which you can change to anything you'd like and then add custom CSS to the public output of your plugin.</p>
<pre><code>+/**
 + * Register WP Dispensary's oEmbed stylesheet
 + */
 +function wpd_oembed_styles() {
 +
 +    wp_register_style( 'wpd-oembed', plugin_dir_url( __FILE__ ) . 'css/wp-dispensary-oembed.css', false, $this-version );
 +    wp_enqueue_style( 'wpd-oembed' );
 +
 +}
 +add_action( 'enqueue_embed_scripts', 'wpd_oembed_styles' );
</code></pre>
<p>See how I handle adding this in with WP Dispensary <a href="https://github.com/deviodigital/wp-dispensary/blob/2a7984cba6308498f3229d9035265bbdc7b2180d/public/class-wp-dispensary-public.php">here</a>.
Below is an example of how the WP Dispensary items get displayed through oEmbed now.
https://www.wpdispensary.com/demo/flowers/chemdawg/</p>
<h2>3. Flush rewrite rules during your plugin's activation</h2>
<p>One thing that I looked over when building the earlier versions of the WPD plugin was <code>flush_rewrite_rules</code>.
If I'm being completely honest, at the time I didn't even know it existed, so I was telling people in a FAQ page how to manually go in and resave their <code>permalinks</code> settings.
We live and learn, right? ?
Thankfully, WordPress does have a page <a href="https://codex.wordpress.org/Function_Reference/flush_rewrite_rules">in the codex</a> on flush rewrite rules to look through.
With the code below, I am able to take the Custom Post Type <code>function</code> and add it to the <a href="https://github.com/deviodigital/wp-dispensary/blob/master/wp-dispensary.php#L37-L40">activation hook</a> within the WPD plugin.
I also do the same for the custom <a href="https://codex.wordpress.org/Taxonomies#Tag">tag</a> and <a href="https://codex.wordpress.org/Taxonomies#Category">category</a> taxonomies for each menu type.</p>
<pre><code>class WP_Dispensary_Activator {
    /**
     * Short Description. (use period)
     *
     * Long Description.
     *
     * @since  1.0.0
     * @access public
     *
     * @global $wp_rewrite
     *
     * @return void
     */
    public static function activate() {
        /**
         * Custom Post Types
         */
        wpdispensary_flowers();
        wpdispensary_edibles();
        wpdispensary_concentrates();
        wpdispensary_prerolls();
        wpdispensary_topicals();
        wpdispensary_growers();
        /**
         * Taxonomies
         */
        wpdispensary_aroma();
        wpdispensary_flavor();
        wpdispensary_effect();
        wpdispensary_symptom();
        wpdispensary_condition();
        wpdispensary_ingredient();
        /**
         * Custom Categories
         */
        wpdispensary_flowercategory();
        wpdispensary_ediblecategory();
        wpdispensary_concentratecategory();
        wpdispensary_topicalcategory();
        wpdispensary_growerscategory();
        /**
         * Flush Rewrite Rules
         */
         global $wp_rewrite;
         $wp_rewrite-&gt;init();
         $wp_rewrite-&gt;flush_rules();
    }
}
</code></pre>
<p>Now any time someone activates your plugin, your custom post types and taxonomies will flush and work with your current <a href="https://codex.wordpress.org/Settings_Permalinks_Screen">permalink</a> settings.</p>
<h2>Additional resources</h2>
<p>Now that we've gone over a few ways to enhance your CPT's, it's time to dig even further and see what else you can do to make your plugins better.
Here's some links to other content that you can check out, written by people much smarter than I am ?
  * <a href="http://www.ibenic.com/5-ways-make-plugin-extensible/">5 Ways to Make your WordPress Plugin Really Extensible</a>
  * <a href="https://hollerwp.com/wordpress-settings-autocomplete-field-using-ajax/">How to Make a WordPress Settings Autocomplete Field Using Ajax</a>
  * <a href="http://www.wpbeginner.com/wp-tutorials/12-most-useful-wordpress-custom-post-types-tutorials/">12 Most Useful WordPress Custom Post Types Tutorials</a></p>
    </div>
</article>

</main>

<footer class="bg-background border-t border-primary mt-10 py-6" id="footer">
    <div class="container max-w-screen-xl m-auto px-4 text-center">
        <p>Get <a href="https://stattic.site/" target="_blank" class="text-links font-bold" aria-label="Stattic - opens in a new tab">Stattic</a></p>
    </div>
</footer>

</body>
</html>